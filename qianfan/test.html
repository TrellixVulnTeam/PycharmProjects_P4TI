<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<meta name="format-detection" content="telephone=no">
<title>任务</title>
<script>!function (e) {
    e.getElementsByTagName("html")[0].style.fontSize = e.documentElement.clientWidth / 32 + "px"
}(document)</script>
<link rel="stylesheet" href="/public/static/dest/css/user/task-d699f7f36c.css">
</head>
<body class="body-single">

<div id="app" class="task">
    <img src="http://pic.magcloud.cc/score_task_cover.png" alt="" width="100%" height="120">
        <div class="panel">
        <div class="panel-hd">新手任务</div>
        <ul class="tasks-challenge">
                        <li data-type="taskcomplete" data-taskid="2" data-usertaskid="" data-link="">
                <span class="cover">
                    <img src="http://pic.magcloud.cc/icon-continuousLogin.png" width="36" height="36" alt="">
                </span>
                <p class="name">连续登录</p>
                <p class="desc"></p>
                <span class="nums">金钱+1</span>
                <div class="status taskcomplete">
                    <p class="tag"><span class="deco">•</span>已完成</p>
                    <div class="btn-text">已领奖</div>
                </div>
            </li>
                        <li data-type="taskcomplete" data-taskid="3" data-usertaskid="" data-link="qianfanedu://useredit">
                <span class="cover">
                    <img src="http://pic.magcloud.cc/icon-perfectInformation.png" width="36" height="36" alt="">
                </span>
                <p class="name">完善资料</p>
                <p class="desc"></p>
                <span class="nums">金钱+1</span>
                <div class="status taskcomplete">
                    <p class="tag"><span class="deco">•</span>已完成</p>
                    <div class="btn-text">已领奖</div>
                </div>
            </li>
                        <li data-type="gotask" data-taskid="1" data-usertaskid="" data-link="/addons/invite/invite/inviteView">
                <span class="cover">
                    <img src="http://pic.magcloud.cc/icon-inviteCode.png" width="36" height="36" alt="">
                </span>
                <p class="name">输入邀请码</p>
                <p class="desc"></p>
                <span class="nums">金钱+1</span>
                <div class="status gotask">
                    <p class="tag"><span class="deco">•</span>未完成</p>
                    <div class="btn-text">前往</div>
                </div>
            </li>
                    </ul>
    </div>

        <div class="panel">
        <div class="panel-hd">每日任务</div>
        <ul class="tasks-challenge">
            <li data-type="getreward" data-taskid="7" data-usertaskid="" data-link="">
                <span class="cover">
                    <img src="http://pic.magcloud.cc/icon-share.png" width="36" height="36" alt="">
                </span>
                <p class="name">分享达人</p>
                <p class="desc">分享到朋友圈</p>
                <span class="nums">金钱+50</span>
                <div class="status taskcomplete">
                                        <p class="tag"><span class="deco">•</span>已完成</p>
                                        <div class="btn-text">已领奖</div>
                </div>
            </li>
            <li data-type="taskdoing" data-taskid="5" data-usertaskid="" data-link="">
                <span class="cover">
                    <img src="http://pic.magcloud.cc/icon-reply.png" width="36" height="36" alt="">
                </span>
                <p class="name">回帖达人</p>
                <p class="desc"></p>
                <span class="nums">金钱+10</span>
                <div class="status taskdoing">
                                        <p class="tag" style="color: #666"><span class="deco" style="color: #A8A8A8">•</span>未完成</p>
                                        <div class="btn-text">领奖</div>
                </div>
            </li>
            <li data-type="taskdoing" data-taskid="6" data-usertaskid="" data-link="">
                <span class="cover">
                    <img src="http://pic.magcloud.cc/icon-thread.png" width="36" height="36" alt="">
                </span>
                <p class="name">发布达人</p>
                <p class="desc"></p>
                <span class="nums">金钱+10</span>
                <div class="status taskdoing">
                                        <p class="tag" style="color: #666"><span class="deco" style="color: #A8A8A8">•</span>1/2</p>
                                        <div class="btn-text">领奖</div>
                </div>
            </li>
            <li data-type="getreward" data-taskid="4" data-usertaskid="1888164" data-link="">
                <span class="cover">
                    <img src="http://pic.magcloud.cc/icon-applaud.png" width="36" height="36" alt="">
                </span>
                <p class="name">点赞达人</p>
                <p class="desc"></p>
                <span class="nums">金钱+1</span>
                <div class="status getreward">
                                        <p class="tag"><span class="deco">•</span>已完成</p>
                                        <div class="btn-text">领奖</div>
                </div>
            </li>
            <li data-type="taskdoing" data-taskid="8" data-usertaskid="" data-link="">
                <span class="cover">
                    <img src="http://pic.magcloud.cc/icon-invitation.png" width="36" height="36" alt="">
                </span>
                <p class="name">有朋自远方来</p>
                <p class="desc"></p>
                <span class="nums">金钱+50</span>
                <div class="status taskdoing">
                                        <p class="tag" style="color: #666"><span class="deco" style="color: #A8A8A8">•</span>未完成</p>
                                        <div class="btn-text">领奖</div>
                </div>
            </li>
                    </ul>
    </div>

        <div class="panel">
        <div class="panel-hd">分享效果任务奖励</div>
        <ul class="tasks-challenge with-award">
            <li data-link="https://app.qianfanedu.cn/mag/circle/v1/show/shareRecord" data-type="gotask">
                <span class="cover">
                    <img src="http://pic.magcloud.cc/share_task.png" width="36" height="36" alt="">
                </span>
                <p class="name">分享效果奖励</p>
                <p class="desc">分享帖子，积分多多</p>
                <span class="gift-detail" @click=""></span>
            </li>
        </ul>
    </div>

    <div id="overlay_task_finished" class="overlay novue">
        <div class="dialog task-finished-dialog">
            <img src="/public/static/imgs/task_icon_finished.png" width="90" height="90" alt="">
            <p class="title"></p>
            <p class="name"></p>
            <p class="nums"></p>
        </div>
    </div>

</div>

<script src="/public/static/dest/js/libs/jquery-1.8.0.min.js"></script>
<script src="/public/static/dest/js/libs/magjs-x.js"></script>
<script>
    (function(){
        mag.setTitle('任务');
        mag.hideMore();
        var isfirst=true;
        mag.setPageLife({
            pageAppear: function () {
                if(!isfirst){
                    window.location.reload();
                }
                isfirst=false;
            },
            pageDisappear: function () {

            }
        });
        var isRequesting = false,
            $taskFinishedOverlay = $('#overlay_task_finished'),
            $taskMsg = $taskFinishedOverlay.find('.title'),
            $taskName = $taskFinishedOverlay.find('.name'),
            $taskNums = $taskFinishedOverlay.find('.nums');
        $('.tasks-challenge li').on('click', function () {
            var type = $(this).data('type'),
                task_id = $(this).data('taskid'),
                usertaskid = $(this).data('usertaskid');
            mission_link = $(this).data('link');
            if(type === 'gotask' && !isRequesting){
                window.location.href = mission_link
            }
            if(type === 'getreward' && !isRequesting){
                isRequesting = true;
                mag.progress();
                $.get('/mag/user/v1/GradeScore/getScoreTaskReward', {
                    id: usertaskid
                }, function (res) {
                    isRequesting = false;
                    mag.hideProgress();
                    if(res.success){
                        $taskMsg.text(res.msg);
                        $taskName.text(res.data.name);
                        $taskNums.text(res.data.score_change_str);
                        $taskFinishedOverlay.fadeIn('fast').on('click', function () {
                            $(this).fadeOut('fast');
                            setTimeout(function () {
                                window.location.reload();
                            }, 1000);
                        });
                    }else{
                        var msg = res.msg || '领取失败';
                        mag.toast(msg);
                    }
                }, 'json');
            }
        });
        $('.tasks-normal .field-cell').on('click', function () {
            mag.newWin($(this).data('link'), {});
        });
    })();
</script>
</body>
</html>
